<header>
	<h1>Ahmed Abo-Shadi</h1>
	<div>
		<a href="tel:+17144635142">+1 (714) 463 5142</a>
		<a href="https://linkedin.com/in/visualplugin">https://linkedin.com/in/visualplugin</a>
		<a href="https://github.com/Windows81">https://github.com/Windows81</a>
		<a href="mailto:aboshadi.n.ahmed@gmail.com">aboshadi.n.ahmed@gmail.com</a>
	</div>
	<sub><span id="date" /></sub>
</header>
<div class="blockContainer" id="cvBody"></div>
<style>
	@media print {
		body {
			margin: 0;
		}
		@page {
			margin: 0.25in;
			size: letter;
		}
	}
	body {
		margin: auto;
	}
	* {
		font-family: "Trebuchet MS", "Lucida Sans Unicode", "Lucida Grande", "Lucida Sans", Arial, sans-serif;
	}
	code {
		font-family: monospace;
	}
	header {
		text-align: center;
		margin: 0;
	}
	header > h1 {
		margin: 0;
	}
	header > sub {
		display: block;
		font-size: 13px;
		margin: 0;
		margin-top: 4px;
		margin-bottom: -20px;
		font-style: italic;
		color: #aaa;
	}
	header > div {
		margin: auto;
		display: grid;
		justify-content: center;
		grid-template-columns: repeat(2, min-content);
	}
	header > div > a {
		margin: 0;
		margin-left: 8px;
		margin-right: 8px;
		display: block;
	}
	.blockContainer {
		display: flex;
		flex-wrap: wrap;
		justify-content: center;
		gap: 8px;
	}
	.blockContainer > .category {
		text-align: right;
		border-bottom: 2px dotted #aaa;
		padding: 0;
		margin: 0;
		margin-top: 16px;
		flex-basis: 100%;
		height: fit-content;
		break-inside: avoid;
		break-after: avoid;
	}
	:root {
		--box-bullet-leader: hsl(0, 0%, 30%);
		--background: hsla(0, 0%, 97%);
	}
	.education {
		--box-bullet-leader: hsl(225, 100%, 30%);
		--background: hsl(225, 100%, 97%);
	}
	.projects {
		--box-bullet-leader: hsl(90, 70%, 30%);
		--background: hsl(90, 70%, 97%);
	}
	.work {
		--box-bullet-leader: hsl(300, 70%, 30%);
		--background: hsl(300, 70%, 97%);
	}
	.blockContainer > .block {
		width: min-content;
		flex-basis: 500px;
		background: var(--background);
		border: 2px solid color-mix(in hsl, var(--box-bullet-leader) 10%, transparent);
		/*
		border: #eee solid 4px;
		border-top: 0;
		border-left: 0;
		*/
		box-sizing: content-box;
		border-radius: 8px;
		padding: 8px;
		break-inside: avoid;
		flex-grow: 1;
	}
	.blockContainer > .block > div {
		font-size: 16px;
		margin-left: 8px;
		text-wrap-mode: nowrap;
		width: fit-content;
	}
	.blockContainer > .block > div::before {
		content: "";
		position: absolute;
		width: 6px;
		height: 6px;
		background-color: var(--box-bullet-leader);
		border-radius: 6px;
		margin-left: -10px;
		margin-top: 5px;
		box-sizing: border-box;
	}
	.blockContainer b,
	.blockContainer strong {
		color: var(--box-bullet-leader);
	}
	.blockContainer > .block > li {
		stroke-linecap: round;
		font-size: 13px;
		border-left: var(--box-bullet-leader) solid 2px;
		padding-left: 13px;
		padding-top: 8px;
		list-style-type: none;
	}
	.blockContainer > .block > li:empty {
		border-bottom: color-mix(in hsl, var(--box-bullet-leader) 10%, transparent) 2px dashed;
	}
	.blockContainer > .block > li:not(:empty)::before {
		display: list-item;
		content: "";
		position: absolute;
		border-bottom: var(--box-bullet-leader) 2px solid;
		border-left: var(--box-bullet-leader) 2px solid;
		width: 10px;
		height: 30px;
		background-color: transparent;
		border-bottom-left-radius: 6px;
		margin-left: -15px;
		margin-top: -20px;
		box-sizing: border-box;
	}
	.blockContainer > .block > li.l2 {
		padding-left: 20px;
		border-left: var(--box-bullet-leader) dashed 2px;
	}
	.blockContainer > .block > li.l2::before {
		width: 12px;
		margin-left: -17px;
		border-left: none;
	}
	.blockContainer > .block > li.l2:has(+ li:not(.l2)) {
		border-left: var(--box-bullet-leader) dotted 2px;
	}
	.blockContainer > .block > li:not(:has(+ li)) {
		border-left: transparent solid 2px !important;
	}
	.blockContainer > .block.skills {
		padding-left: 24px;
		display: flex;
		flex-wrap: wrap;
		justify-content: space-between;
	}
	.blockContainer > .block.skills > div {
		font-size: 14px;
		flex-basis: 144px;
	}
</style>
<script>
	const LISTED_CATEGORIES = {
		education: "Education",
		skills: "Listed Skills",
		work: "Employment",
		projects: "Projects & Research",
	};

	function loadFile(path) {
		try {
			const request = new XMLHttpRequest();
			request.open("GET", path, false);
			request.send(null);
			if (request.status === 200) return request.responseText;
		} catch (e) {
			return;
		}
	}

	function getJobDescription(cvName) {
		const fileData = loadFile(`./${cvName}/_job_desc.txt`) ?? "";
		return new Set(
			fileData
				.toLowerCase()
				.matchAll(/(\w+)/gi)
				.map(([e, ..._]) => e)
		);
	}

	function genItemElement(category, itemLines) {
		var mainEl = document.createElement("div");
		mainEl.className = `block ${category}`;

		if (LISTED_CATEGORIES[category] == LISTED_CATEGORIES.skills) {
			mainEl.append(
				...itemLines.map((data) => {
					var el = document.createElement("div");
					el.innerHTML = data;
					return el;
				})
			);
			return mainEl;
		}

		var [date, title, ...itemLines] = itemLines;
		var titleEl = document.createElement("div");
		titleEl.innerHTML = `<b>${title}</b> &ndash; ${date}`;
		mainEl.append(
			titleEl,
			...itemLines.map((data) => {
				var tag = "li";
				var cls = "";
				if (data.startsWith("-")) {
					data = data.substring("-".length);
				} else if (data.startsWith("  -")) {
					data = data.substring("  -".length);
					cls = "l2";
				}
				var el = document.createElement(tag);
				el.innerHTML = data;
				el.className = cls;
				return el;
			})
		);
		return mainEl;
	}

	function genCategoryElements(cvName, category, cName) {
		var dataStr = loadFile(`./${cvName}/${category}.txt`);
		var cvData = dataStr.split("\n\n").map((s) => s.split("\n"));

		var categoryEl = document.createElement("div");
		categoryEl.className = `category ${category}`;
		categoryEl.innerText = cName;
		return [categoryEl, ...cvData.flatMap((cvItem) => genItemElement(category, cvItem))];
	}

	const cvName = new URLSearchParams(window.location.search).get("cvProfile") ?? loadFile("_current_cv_profile.txt") ?? "cv";
	const bodyEl = document.getElementById("cvBody");

	bodyEl.append(
		...Object.entries(LISTED_CATEGORIES).flatMap(([category, cName]) => genCategoryElements(cvName, category, cName))
	);

	// If a job description is provided, looks for words in the CV to replace with what exactly is in that job description, so as to make the applicant-tracking systems happy.
	// E.g. <choice>first choice|second choice|last choice or default</choice>
	const jobDescription = getJobDescription(cvName);
	for (const choice of bodyEl.querySelectorAll("choice")) {
		const options = choice.innerText.split("|");
		let option;
		for (option of options) {
			const words = option.matchAll(/(\w+)/gi);
			if (!words.some((e) => jobDescription.has(e))) continue;
			break;
		}
		choice.innerText = option;
	}

	document.getElementById("date").innerText = new Intl.DateTimeFormat("en-SE", {
		dateStyle: "full",
		timeStyle: "long",
	}).format(new Date());
</script>
